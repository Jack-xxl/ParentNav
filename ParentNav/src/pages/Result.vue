<template>
  <div class="result-page">
    <div class="header card">
      <div class="title-row">
        <h2>è‚²å„¿æµ‹è¯„æŠ¥å‘Š</h2>
        <div class="meta">
          <span class="pill">é¢˜ç›®ï¼š{{ totalQuestions }}é¢˜</span>
          <span class="pill">ç»´åº¦ï¼š{{ orderedDims.length }}é¡¹</span>
          <span class="pill">ç»¼åˆåˆ†ï¼š{{ overallScore }}</span>
        </div>
      </div>

      <div class="grid-two">
        <div class="card inner">
          <div class="section-title">å…­ç»´é›·è¾¾å›¾</div>
          <div ref="radarRef" class="radar"></div>
          <div class="note">
            åˆ†æ•°ä¸ºç™¾åˆ†åˆ¶ï¼ˆ0-100ï¼‰ï¼Œè¶Šé«˜ä»£è¡¨è¯¥ç»´åº¦çš„æ”¯æŒä¸èƒ½åŠ›è¶Šå¼ºã€‚
          </div>
        </div>

        <div class="card inner">
          <div class="section-title">å®¶åº­äººæ‰ç”»åƒ</div>

          <div class="portrait">
            <div class="portrait-name">{{ portrait.name }}</div>
            <div class="portrait-desc">{{ portrait.desc }}</div>

            <div class="portrait-box">
              <div class="portrait-sub">ä¸»è¦ç‰¹å¾</div>
              <ul>
                <li v-for="(t, idx) in portrait.traits" :key="idx">{{ t }}</li>
              </ul>
            </div>

            <div class="portrait-box warn" v-if="portrait.risks.length">
              <div class="portrait-sub">æ½œåœ¨é£é™©æç¤º</div>
              <ul>
                <li v-for="(r, idx) in portrait.risks" :key="idx">{{ r }}</li>
              </ul>
            </div>

            <div class="portrait-box good">
              <div class="portrait-sub">ä¼˜å…ˆå»ºè®®</div>
              <ul>
                <li v-for="(a, idx) in portrait.actions" :key="idx">{{ a }}</li>
              </ul>
            </div>
          </div>

          <div class="divider"></div>

          <div class="section-title">3ä¸ªæœˆè¡ŒåŠ¨è®¡åˆ’ï¼ˆå¯è½åœ°ï¼‰</div>
          <div class="plan">
            <div class="plan-col">
              <div class="plan-h">æœ¬å‘¨å¿…é¡»å®Œæˆ</div>
              <ul>
                <li v-for="(x, idx) in portrait.plan.week" :key="'w' + idx">{{ x }}</li>
              </ul>
            </div>
            <div class="plan-col">
              <div class="plan-h">æœ¬æœˆç›®æ ‡</div>
              <ul>
                <li v-for="(x, idx) in portrait.plan.month" :key="'m' + idx">{{ x }}</li>
              </ul>
            </div>
            <div class="plan-col">
              <div class="plan-h">3ä¸ªæœˆéªŒæ”¶æ ‡å‡†</div>
              <ul>
                <li v-for="(x, idx) in portrait.plan.qtr" :key="'q' + idx">{{ x }}</li>
              </ul>
            </div>
          </div>

          <button class="btn upgrade" @click="goUpgrade">å‡çº§è§£é”å®Œæ•´ç‰ˆæŠ¥å‘Š</button>
        </div>
      </div>
    </div>

    <div class="card modules">
      <div class="section-title">å„ç»´åº¦è¯¦ç»†åé¦ˆï¼ˆå®¢è§‚è¯„ä»· + ä¸‹ä¸€æ­¥å»ºè®®ï¼‰</div>

      <div class="module-grid">
        <div v-for="r in results" :key="r.module" class="module-card">
          <div class="module-head">
            <div class="module-name">{{ r.module }}</div>
            <div class="badge" :class="badgeClass(r.level)">{{ r.level }}</div>
          </div>

          <div class="score-row">
            <div class="score-num">{{ r.score }}</div>
            <div class="score-tip">
              <div class="tip-1">{{ r.judgement }}</div>
              <div class="tip-2">{{ r.coreLine }}</div>
            </div>
          </div>

          <div class="suggest">
            <div class="suggest-title">å»ºè®®</div>
            <div class="suggest-text">{{ r.suggestion }}</div>
          </div>

          <div class="mini">
            <span class="mini-pill">ä¼˜åŠ¿ï¼š{{ r.strength }}</span>
            <span class="mini-pill warn">çŸ­æ¿ï¼š{{ r.weakness }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="card footer">
      <div class="footer-title">æç¤º</div>
      <div class="footer-text">
        ä½åˆ†ä¸æ˜¯â€œä½ ä¸è¡Œâ€ï¼Œè€Œæ˜¯â€œæœ€å€¼å¾—ä¼˜å…ˆè¡¥å¼ºçš„æ–¹å‘â€ã€‚é«˜åˆ†ä¹Ÿä¸æ˜¯ç»ˆç‚¹ï¼Œè€Œæ˜¯ä½ å·²ç»åšå¯¹äº†ï¼Œéœ€è¦ä¿æŒå¹¶ç»§ç»­å‡çº§æ–¹æ³•ã€‚
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted, onBeforeUnmount, watch } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import * as echarts from 'echarts'

const route = useRoute()
const router = useRouter()
const radarRef = ref(null)
let chart = null

// ä½ ç°åœ¨çš„ Assessment.vue ä¼šä¼ è¿™äº› queryï¼š
// scores: JSON.stringify(moduleScores)ï¼ˆåŸå§‹åˆ†ï¼‰
// maxMap: JSON.stringify(maxMap)ï¼ˆæ¯ä¸ªç»´åº¦æœ€å¤§å¯å¾—åˆ†ï¼‰
// counts: JSON.stringify(moduleCounts)
const rawScores = computed(() => {
  try {
    return route.query.scores ? JSON.parse(route.query.scores) : {}
  } catch {
    return {}
  }
})

const maxMap = computed(() => {
  try {
    return route.query.maxMap ? JSON.parse(route.query.maxMap) : {}
  } catch {
    return {}
  }
})

const counts = computed(() => {
  try {
    return route.query.counts ? JSON.parse(route.query.counts) : {}
  } catch {
    return {}
  }
})

const preferredOrder = ['å®¶åº­è´£ä»»', 'æˆäºº', 'æˆæ‰', 'è°‹ç”Ÿæ‰‹æ®µ', 'æˆä¸ºè‡ªå·±', 'å¹¸ç¦åŠ›']

const orderedDims = computed(() => {
  const keys = Object.keys(rawScores.value || {})
  // å¦‚æœæŸäº›ç»´åº¦æ²¡åœ¨ preferredOrderï¼Œä¹ŸæŠŠå®ƒä»¬è¿½åŠ åœ¨åé¢
  const rest = keys.filter(k => !preferredOrder.includes(k))
  const inOrder = preferredOrder.filter(k => keys.includes(k))
  return [...inOrder, ...rest]
})

const totalQuestions = computed(() => {
  // counts æ˜¯æ¯ä¸ªç»´åº¦é¢˜ç›®æ•°é‡çš„åŠ æ€»
  const c = counts.value || {}
  const sum = Object.values(c).reduce((acc, n) => acc + (Number(n) || 0), 0)
  return sum || 38
})

function clamp(n, a, b) {
  return Math.max(a, Math.min(b, n))
}

function toPercent(raw, max) {
  const r = Number(raw)
  const m = Number(max)
  if (!Number.isFinite(r)) return 0
  if (!Number.isFinite(m) || m <= 0) {
    // å…œåº•ï¼šå¦‚æœæ²¡ maxMapï¼Œå°±æŒ‰â€œæ¯é¢˜æœ€é«˜4åˆ†â€ç²—ç•¥ä¼°
    // ä½†ä½ ç›®å‰ Assessment.vue å·²ç»ä¼  maxMapï¼Œæ‰€ä»¥åŸºæœ¬ç”¨ä¸ä¸Š
    return clamp(Math.round(r), 0, 100)
  }
  return clamp(Math.round((r / m) * 100), 0, 100)
}

function getLevel(score) {
  if (score < 60) return 'åˆæ­¥æ¢ç´¢'
  if (score < 70) return 'åŸºç¡€é˜¶æ®µ'
  if (score < 85) return 'è¿›é˜¶é˜¶æ®µ'
  if (score < 95) return 'é«˜çº§é˜¶æ®µ'
  return 'ä¼˜ç§€é˜¶æ®µ'
}

function badgeClass(level) {
  if (level === 'ä¼˜ç§€é˜¶æ®µ') return 'b-excellent'
  if (level === 'é«˜çº§é˜¶æ®µ') return 'b-advanced'
  if (level === 'è¿›é˜¶é˜¶æ®µ') return 'b-good'
  if (level === 'åŸºç¡€é˜¶æ®µ') return 'b-basic'
  return 'b-start'
}

// å»ºè®®åº“ï¼šæŒ‰â€œç»´åº¦ + ç­‰çº§â€ç»™å»ºè®®ï¼ˆä½ å¯éšæ—¶ç»§ç»­æ‰©å……æ–‡æ¡ˆï¼‰
const adviceMap = {
  æˆäºº: {
    åˆæ­¥æ¢ç´¢: 'å…ˆä»â€œå¯è§çš„ç¤ºèŒƒâ€å¼€å§‹ï¼šå¯¹å­©å­æ‰¿è®¤é”™è¯¯ã€éµå®ˆæ‰¿è¯ºã€æ§åˆ¶æƒ…ç»ªã€‚æ¯å‘¨è‡³å°‘1æ¬¡å¤ç›˜ï¼šæˆ‘ä»Šå¤©å“ªé‡Œåšå¾—æ›´åƒä¸€ä¸ªæˆç†Ÿçš„å¤§äººï¼Ÿ',
    åŸºç¡€é˜¶æ®µ: 'ä½ å·²ç»å¼€å§‹é‡è§†å“æ ¼ä¸è‡ªæˆ‘æˆé•¿ã€‚ä¸‹ä¸€æ­¥ï¼šæŠŠâ€œè§„åˆ™ä¸€è‡´æ€§â€åšæ‰å®â€”â€”è¯´åˆ°åšåˆ°ã€å¥–æƒ©ä¸€è‡´ã€å°‘æƒ…ç»ªåŒ–å¤„ç†å†²çªã€‚',
    è¿›é˜¶é˜¶æ®µ: 'ä½ åœ¨â€œä»¥èº«ä½œåˆ™â€æ–¹é¢å·²ç»æœ‰ä½“ç³»ã€‚å»ºè®®åŠ å¼ºï¼šè®©å­©å­å‚ä¸è§„åˆ™ä¸åæœè®¾è®¡ï¼ŒåŸ¹å…»è´£ä»»æ‰¿æ‹…ä¸è‡ªæˆ‘ç®¡ç†ã€‚',
    é«˜çº§é˜¶æ®µ: 'ä½ çš„å“æ ¼ç¤ºèŒƒéå¸¸ç¨³å®šã€‚å»ºè®®ï¼šå¼€å§‹æŠŠâ€œå“æ ¼â€è½¬åŒ–ä¸ºâ€œè¡ŒåŠ¨è®­ç»ƒâ€ï¼Œä¾‹å¦‚ï¼šé•¿æœŸé¡¹ç›®ã€å»¶è¿Ÿæ»¡è¶³ã€æŠ—æŒ«è®­ç»ƒã€‚',
    ä¼˜ç§€é˜¶æ®µ: 'ä½ å·²å…·å¤‡å¼ºå¤§çš„æ¦œæ ·åŠ›é‡ã€‚å»ºè®®ï¼šä¿æŒåŒæ—¶ï¼Œé‡ç‚¹å¸®åŠ©å­©å­å½¢æˆâ€œè‡ªé©±å¤ç›˜ç³»ç»Ÿâ€ï¼Œè®©å­©å­æœªæ¥ç¦»å¼€ä½ ä¹Ÿèƒ½ç¨³ä½è‡ªå·±ã€‚'
  },
  æˆæ‰: {
    åˆæ­¥æ¢ç´¢: 'æŠŠå…³æ³¨ç‚¹ä»â€œåˆ†æ•°â€è½¬å‘â€œèƒ½åŠ›â€ï¼šæ¯å‘¨ä¸€æ¬¡å¸¦å­©å­åšä¸€ä¸ªå°é¡¹ç›®ï¼ˆå†™ä½œ/å±•ç¤º/å®éªŒ/åˆ›ä½œï¼‰ï¼Œè®©å­¦ä¹ äº§ç”Ÿç»“æœã€‚',
    åŸºç¡€é˜¶æ®µ: 'ä½ å·²å¼€å§‹å…³æ³¨ç»¼åˆèƒ½åŠ›ã€‚å»ºè®®ï¼šå¢åŠ â€œæ–¹æ³•è®ºè®­ç»ƒâ€â€”â€”å¦‚ä½•æé—®ã€å¦‚ä½•æ‰¾èµ„æ–™ã€å¦‚ä½•æ‹†è§£é—®é¢˜ã€å¦‚ä½•å¤ç›˜ã€‚',
    è¿›é˜¶é˜¶æ®µ: 'ä½ çš„å­¦ä¹ å¼•å¯¼æ›´ç³»ç»Ÿäº†ã€‚å»ºè®®ï¼šå»ºç«‹â€œå­©å­çš„ä½œå“é›†â€ï¼Œè®©èƒ½åŠ›å¯è§ã€å¯ç§¯ç´¯ã€å¯å±•ç¤ºã€‚',
    é«˜çº§é˜¶æ®µ: 'ä½ æ­£åœ¨æŠŠå­¦ä¹ å˜æˆå¯æŒç»­ç³»ç»Ÿã€‚å»ºè®®ï¼šå¼•å…¥AIåä½œ/æ‰¹åˆ¤æ€§æ€ç»´è®­ç»ƒï¼ŒæŠŠå­¦ä¹ æ•ˆç‡ä¸è´¨é‡åŒæ—¶æŠ¬å‡ã€‚',
    ä¼˜ç§€é˜¶æ®µ: 'ä½ çš„å­¦ä¹ ä½“ç³»éå¸¸æˆç†Ÿã€‚å»ºè®®ï¼šä»¥â€œçœŸå®ä¸–ç•Œé—®é¢˜â€ä¸ºé©±åŠ¨ï¼Œè®©å­©å­ç”¨èƒ½åŠ›è§£å†³çœŸå®éœ€æ±‚ï¼Œå½¢æˆç«äº‰åŠ›é—­ç¯ã€‚'
  },
  å®¶åº­è´£ä»»: {
    åˆæ­¥æ¢ç´¢: 'å…ˆä»â€œé™ªä¼´è´¨é‡â€å¼€å§‹ï¼šæ¯å¤©15åˆ†é’Ÿæ— æ‰‹æœºé™ªä¼´ + æ¯å‘¨ä¸€æ¬¡å®¶åº­ä¼šè®®ï¼Œè®©å­©å­æœ‰è¡¨è¾¾ä¸å‚ä¸æ„Ÿã€‚',
    åŸºç¡€é˜¶æ®µ: 'ä½ å·²å¼€å§‹åæ€å®¶åº­äº’åŠ¨ã€‚å»ºè®®ï¼šæŠŠâ€œè§„åˆ™â€å˜æˆå…±åŒåˆ¶å®šï¼Œå¹¶æŠŠè¾¹ç•Œç¨³å®šä¸‹æ¥ï¼ˆå°‘å‘½ä»¤ï¼Œå¤šåå•†ï¼‰ã€‚',
    è¿›é˜¶é˜¶æ®µ: 'å®¶åº­æ°›å›´åœ¨æ”¹å–„ã€‚å»ºè®®ï¼šå¢åŠ â€œæ”¾æ‰‹è®­ç»ƒâ€â€”â€”è®©å­©å­ä¸ºè‡ªå·±çš„é€‰æ‹©æ‰¿æ‹…åæœï¼Œä½ æä¾›æ”¯æŒè€Œéä»£åŠ³ã€‚',
    é«˜çº§é˜¶æ®µ: 'ä½ çš„å®¶åº­ç³»ç»Ÿæ¯”è¾ƒæ¸…æ™°ã€‚å»ºè®®ï¼šå»ºç«‹â€œå…³é”®èŠ‚ç‚¹å¯¼èˆªæœºåˆ¶â€ï¼ˆæ‹©æ ¡ã€å…´è¶£ã€èŒä¸šå¯è’™ï¼‰è®©å­©å­ä¸èµ°å¼¯è·¯ã€‚',
    ä¼˜ç§€é˜¶æ®µ: 'å®¶åº­ç³»ç»Ÿç¨³å®šå¥åº·ã€‚å»ºè®®ï¼šä¿æŒå¹¶å‡çº§ä¸ºâ€œå®¶åº­æˆé•¿ç³»ç»Ÿâ€ï¼ˆå­£åº¦ç›®æ ‡+å¤ç›˜ï¼‰ï¼ŒæŠŠä¼˜åŠ¿å˜æˆé•¿æœŸæŠ¤åŸæ²³ã€‚'
  },
  è°‹ç”Ÿæ‰‹æ®µ: {
    åˆæ­¥æ¢ç´¢: 'ä»â€œç°å®æ„Ÿâ€å¼€å§‹ï¼šå’Œå­©å­è®¨è®ºèŒä¸šã€ä»·å€¼äº¤æ¢ã€é’±çš„æ¥æºã€‚æ¯æœˆä¸€æ¬¡è®©å­©å­åšä¸€ä¸ªâ€œå¯äº¤ä»˜çš„å°ä»»åŠ¡â€ã€‚',
    åŸºç¡€é˜¶æ®µ: 'ä½ å·²ç»å¼€å§‹å…³æ³¨æœªæ¥å‡ºè·¯ã€‚å»ºè®®ï¼šå¼•å…¥AIå·¥å…·ä¸é¡¹ç›®å®è·µï¼Œè®©å­©å­å½¢æˆâ€œèƒ½è§£å†³é—®é¢˜â€çš„èƒ½åŠ›ã€‚',
    è¿›é˜¶é˜¶æ®µ: 'ä½ çš„ç”Ÿå­˜åŠ›åŸ¹å…»åœ¨æ¨è¿›ã€‚å»ºè®®ï¼šå»ºç«‹â€œæŠ€èƒ½Ã—ä½œå“Ã—ä¿¡ç”¨â€çš„è·¯å¾„ï¼šæŠ€èƒ½å­¦ä¹ â†’ä½œå“é›†â†’çœŸå®åé¦ˆã€‚',
    é«˜çº§é˜¶æ®µ: 'ä½ å·²å…·å¤‡æœªæ¥å¯¼å‘ã€‚å»ºè®®ï¼šå¢åŠ çœŸå®ç¤¾ä¼šä½“éªŒï¼ˆé¡¹ç›®/å®ä¹ /åˆ›ä¸šå°è¯•ï¼‰ï¼Œè®©å­©å­å½¢æˆä»·å€¼åˆ›é€ é—­ç¯ã€‚',
    ä¼˜ç§€é˜¶æ®µ: 'ä½ åœ¨è°‹ç”Ÿèƒ½åŠ›ä¸Šéå¸¸é¢†å…ˆã€‚å»ºè®®ï¼šä¿æŒå¹¶æŠŠå­©å­å¸¦å…¥æ›´é«˜æŒ‘æˆ˜ï¼šæŒç»­ç›ˆåˆ©ã€å›¢é˜Ÿåä½œã€é•¿æœŸé¡¹ç›®ç®¡ç†ã€‚'
  },
  æˆä¸ºè‡ªå·±: {
    åˆæ­¥æ¢ç´¢: 'å…ˆåœæ­¢â€œæ¯”è¾ƒâ€å’Œâ€œå®šå‹â€ã€‚æ¯å‘¨ä¸€æ¬¡è®©å­©å­è®²è¿°è‡ªå·±çš„æƒ³æ³•ï¼Œä½ åªåšæé—®å’Œå€¾å¬ã€‚',
    åŸºç¡€é˜¶æ®µ: 'ä½ å¼€å§‹å°Šé‡å­©å­ç‹¬ç‰¹æ€§ã€‚å»ºè®®ï¼šç»™å­©å­ä¸€ä¸ªå¯æŒç»­æ¢ç´¢çš„é¢†åŸŸï¼ˆ3ä¸ªæœˆï¼‰ï¼Œå¹¶æä¾›èµ„æºä¸å±•ç¤ºæœºä¼šã€‚',
    è¿›é˜¶é˜¶æ®µ: 'å­©å­çš„ç‹¬ç«‹è¡¨è¾¾åœ¨å¢å¼ºã€‚å»ºè®®ï¼šå»ºç«‹â€œé€‰æ‹©æƒè®­ç»ƒâ€ï¼ˆä»å°äº‹åˆ°å¤§äº‹ï¼‰ï¼Œè®©å­©å­é€æ­¥å­¦ä¼šå†³ç­–ã€‚',
    é«˜çº§é˜¶æ®µ: 'å­©å­çš„ç‹¬ç‰¹æ€§è¢«æ¿€å‘ã€‚å»ºè®®ï¼šæŠŠå…´è¶£å˜æˆâ€œèƒ½åŠ›ä½œå“â€ï¼ŒåŒæ—¶è®­ç»ƒä¸ç°å®è¿æ¥ï¼ˆä»·å€¼ã€å¸‚åœºã€åˆä½œï¼‰ã€‚',
    ä¼˜ç§€é˜¶æ®µ: 'ä½ é«˜åº¦å°Šé‡å¹¶æ¿€å‘å­©å­ç‹¬ç‰¹æ€§ã€‚å»ºè®®ï¼šä¿æŒå¹¶å¼•å…¥æ›´é«˜é˜¶çš„æŒ‘æˆ˜ï¼Œè®©å­©å­åœ¨çœŸå®ä¸–ç•Œä¸­éªŒè¯ä¸æˆé•¿ã€‚'
  },
  å¹¸ç¦åŠ›: {
    åˆæ­¥æ¢ç´¢: 'å…ˆä»â€œæƒ…ç»ªè¯†åˆ«â€å¼€å§‹ï¼šå­©å­æƒ…ç»ªæ¥æ—¶å…ˆå…±æƒ…å†è§£å†³é—®é¢˜ã€‚æ¯å¤©ä¸€å¥â€œä½ ç°åœ¨æ˜¯ä»€ä¹ˆæ„Ÿå—ï¼Ÿâ€',
    åŸºç¡€é˜¶æ®µ: 'ä½ å¼€å§‹å…³æ³¨æƒ…ç»ªå¥åº·ã€‚å»ºè®®ï¼šå»ºç«‹â€œæƒ…ç»ªå¤ç›˜â€ä¹ æƒ¯ï¼šå‘ç”Ÿäº†ä»€ä¹ˆâ†’æˆ‘æ„Ÿå—â†’æˆ‘éœ€è¦â†’æˆ‘å¯ä»¥æ€ä¹ˆåšã€‚',
    è¿›é˜¶é˜¶æ®µ: 'ä½ èƒ½å¼•å¯¼å­©å­é¢å¯¹å‹åŠ›ã€‚å»ºè®®ï¼šè¡¥ä¸Šâ€œæŠ—æŒ«è®­ç»ƒâ€ï¼šå°å¤±è´¥å¯æ§å‘ç”Ÿï¼Œå¹¶å¤ç›˜æ–¹æ³•è€Œéè´£å¤‡ã€‚',
    é«˜çº§é˜¶æ®µ: 'ä½ å…·å¤‡æƒ…ç»ªé™ªä¼´èƒ½åŠ›ã€‚å»ºè®®ï¼šæŠŠå¹¸ç¦åŠ›ä¸ç›®æ ‡æ„Ÿç»“åˆï¼šæ—¢èƒ½ç¨³å®šæƒ…ç»ªï¼Œä¹Ÿèƒ½æŒç»­è¡ŒåŠ¨ã€‚',
    ä¼˜ç§€é˜¶æ®µ: 'æƒ…ç»ªæ™ºæ…§æ˜¾è‘—ã€‚å»ºè®®ï¼šä¿æŒå¹¶è®­ç»ƒå­©å­â€œè‡ªæˆ‘è°ƒèŠ‚ç³»ç»Ÿâ€ï¼ˆç¡çœ /è¿åŠ¨/è¡¨è¾¾/å…³ç³»ï¼‰ï¼Œå½¢æˆé•¿æœŸå¿ƒç†éŸ§æ€§ã€‚'
  }
}

function getJudgement(score) {
  if (score < 60) return 'çŸ­æ¿æ˜æ˜¾ï¼šéœ€è¦ä¼˜å…ˆè¡¥å¼º'
  if (score < 70) return 'åŸºç¡€å¯ç”¨ï¼šè¿˜ä¸å¤Ÿç¨³å®š'
  if (score < 85) return 'è¡¨ç°è‰¯å¥½ï¼šç»§ç»­ç³»ç»ŸåŒ–'
  if (score < 95) return 'èƒ½åŠ›å¾ˆå¼ºï¼šä¿æŒå¹¶å‡çº§'
  return 'éå¸¸ä¼˜ç§€ï¼šå·²å½¢æˆä¼˜åŠ¿æŠ¤åŸæ²³'
}

function getCoreLine(module, score) {
  // ç”¨ä¸€å¥è¯æŠŠâ€œä½ åšå¾—æ€ä¹ˆæ ·â€è¯´æ¸…æ¥š
  const lines = {
    å®¶åº­è´£ä»»: [
      'äº²å­è¿æ¥ä¸è¶³ï¼Œå­©å­å®¹æ˜“ç¼ºå°‘å®‰å…¨æ„Ÿä¸å¯¼èˆªã€‚',
      'å¼€å§‹æœ‰é™ªä¼´ä¸å‚ä¸ï¼Œä½†ä¸€è‡´æ€§è¿˜éœ€åŠ å¼ºã€‚',
      'å®¶åº­äº’åŠ¨æ›´å¥åº·ï¼Œå­©å­å‚ä¸æ„Ÿåœ¨æå‡ã€‚',
      'å®¶åº­ç³»ç»Ÿç¨³å®šï¼Œä½ èƒ½åœ¨å…³é”®èŠ‚ç‚¹æä¾›å¯¼èˆªã€‚',
      'å®¶åº­æ°›å›´ä¸è§„åˆ™éƒ½å¾ˆä¼˜ç§€ï¼Œé•¿æœŸå½±å“åŠ›å¼ºã€‚'
    ],
    æˆäºº: [
      'æ¦œæ ·ç¤ºèŒƒä¸å¤Ÿç¨³å®šï¼Œå­©å­å®¹æ˜“å­¦åˆ°â€œæƒ…ç»ªåŒ–å¤„ç†â€ã€‚',
      'å¼€å§‹åæ€ä¸æ”¹è¿›ï¼Œä½†éœ€è¦æ›´ç¨³å®šçš„è‡ªå¾‹ä¸ä¸€è‡´æ€§ã€‚',
      'ä½ å·²èƒ½ä»¥èº«ä½œåˆ™ï¼Œå­©å­ä¼šæ›´æ„¿æ„ä¿¡ä»»ä¸å­¦ä¹ ã€‚',
      'ä½ æ˜¯ç¨³å®šçš„æ¦œæ ·ï¼Œå­©å­çš„å“æ ¼åŸºç¡€ä¼šæ›´æ‰å®ã€‚',
      'ä½ å…·å¤‡å¼ºå¤§æ¦œæ ·åŠ›ï¼Œå¯å¸¦åŠ¨å­©å­é•¿æœŸè‡ªé©±æˆé•¿ã€‚'
    ],
    æˆæ‰: [
      'åå‘åº”è¯•ï¼Œå­¦ä¹ å¾ˆéš¾å˜æˆå¯è¿ç§»èƒ½åŠ›ã€‚',
      'å¼€å§‹å…³æ³¨èƒ½åŠ›ï¼Œä½†ç¼ºå°‘â€œæ–¹æ³•è®º+ä½œå“â€çš„ä½“ç³»ã€‚',
      'å­¦ä¹ å¼•å¯¼æ›´æœ‰æ•ˆï¼Œå­©å­èƒ½åŠ›å¼€å§‹å¯è§åŒ–ã€‚',
      'ä½ èƒ½æŠŠå­¦ä¹ ç³»ç»ŸåŒ–ï¼Œå­©å­èƒ½äº§å‡ºç»“æœä¸ä½œå“ã€‚',
      'å­¦ä¹ ä½“ç³»éå¸¸æˆç†Ÿï¼Œèƒ½å¯¹æ¥çœŸå®ä¸–ç•Œéœ€æ±‚ã€‚'
    ],
    è°‹ç”Ÿæ‰‹æ®µ: [
      'å¯¹æœªæ¥å‡ºè·¯å‡†å¤‡ä¸è¶³ï¼Œå­˜åœ¨â€œé«˜å­¦å†ä½å°±ä¸šâ€é£é™©ã€‚',
      'å¼€å§‹å…³æ³¨è¶‹åŠ¿ï¼Œä½†è¿˜éœ€è¦è½åœ°çš„é¡¹ç›®è®­ç»ƒã€‚',
      'è°‹ç”Ÿæ„è¯†åœ¨å½¢æˆï¼Œå»ºè®®åŠ é€Ÿâ€œæŠ€èƒ½Ã—ä½œå“â€é—­ç¯ã€‚',
      'ä½ å·²å…·å¤‡æœªæ¥å¯¼å‘ï¼Œå­©å­èƒ½æ›´æ—©å»ºç«‹ä»·å€¼åˆ›é€ èƒ½åŠ›ã€‚',
      'è°‹ç”Ÿèƒ½åŠ›éå¸¸é¢†å…ˆï¼Œå…·å¤‡AIæ—¶ä»£æ ¸å¿ƒç«äº‰åŠ›ã€‚'
    ],
    æˆä¸ºè‡ªå·±: [
      'è‡ªä¸»æ€§ä¸è¶³ï¼Œå®¹æ˜“è¢«ä¸»æµè¯„ä»·ç‰µç€èµ°ã€‚',
      'å¼€å§‹å°Šé‡ç‹¬ç‰¹æ€§ï¼Œä½†è¿˜éœ€è¦æŒç»­èµ„æºæŠ•å…¥ã€‚',
      'ç‹¬ç«‹è¡¨è¾¾ä¸é€‰æ‹©èƒ½åŠ›åœ¨å¢å¼ºã€‚',
      'å­©å­çš„ç‹¬ç‰¹æ€§è¢«ç¨³å®šæ”¯æŒï¼Œèƒ½é€æ­¥å½¢æˆæ–¹å‘æ„Ÿã€‚',
      'å­©å­æœ‰å¼ºçƒˆè‡ªæˆ‘ä¸æ–¹å‘æ„Ÿï¼Œæœªæ¥æˆé•¿ç©ºé—´å¾ˆå¤§ã€‚'
    ],
    å¹¸ç¦åŠ›: [
      'æƒ…ç»ªæ”¯æŒä¸è¶³ï¼Œå‹åŠ›ä¸‹å®¹æ˜“å´©æºƒæˆ–å¯¹æŠ—ã€‚',
      'å¼€å§‹å…³æ³¨æƒ…ç»ªï¼Œä½†ç¼ºå°‘æ–¹æ³•ä¸æ—¥å¸¸ç»ƒä¹ ã€‚',
      'èƒ½é¢å¯¹å‹åŠ›å¹¶å¤ç›˜ï¼Œå¿ƒç†éŸ§æ€§åœ¨æå‡ã€‚',
      'ä½ æœ‰ç¨³å®šçš„æƒ…ç»ªé™ªä¼´èƒ½åŠ›ï¼Œå­©å­æ›´ä¸æ˜“å†…è€—ã€‚',
      'æƒ…ç»ªæ™ºæ…§çªå‡ºï¼Œå­©å­ä¼šæ‹¥æœ‰å¼ºå¤§å¿ƒç†éŸ§æ€§ã€‚'
    ]
  }
  const arr = lines[module]
  if (!arr) return 'æ ¹æ®åˆ†æ•°è¡¨ç°ï¼Œå»ºè®®ç»§ç»­ä¼˜åŒ–æ–¹æ³•å¹¶æŒç»­å¤ç›˜ã€‚'
  const idx = score < 60 ? 0 : score < 70 ? 1 : score < 85 ? 2 : score < 95 ? 3 : 4
  return arr[idx]
}

function getStrengthWeakness(module, score) {
  // ç®€æ´â€œä¼˜åŠ¿/çŸ­æ¿â€
  if (score >= 85) return { strength: 'ç¨³å®šè¾“å‡º', weakness: 'é¿å…æ‰ä»¥è½»å¿ƒ' }
  if (score >= 70) return { strength: 'æ–¹å‘æ­£ç¡®', weakness: 'éœ€è¦ç³»ç»ŸåŒ–' }
  if (score >= 60) return { strength: 'åŸºç¡€å…·å¤‡', weakness: 'ç¨³å®šæ€§ä¸è¶³' }
  return { strength: 'å¯æå‡ç©ºé—´å¤§', weakness: 'éœ€è¦ä¼˜å…ˆè¡¥å¼º' }
}

const results = computed(() => {
  const dims = orderedDims.value
  return dims.map((module) => {
    const raw = rawScores.value?.[module] ?? 0
    const max = maxMap.value?.[module] ?? 0
    const score = toPercent(raw, max)
    const level = getLevel(score)
    const suggestion = adviceMap[module]?.[level] || 'å»ºè®®ï¼šå…ˆä»â€œæ¯å‘¨ä¸€æ¬¡å¤ç›˜ + ä¸€ä¸ªå°è¡ŒåŠ¨â€å¼€å§‹ï¼ŒæŠŠç†å¿µå˜æˆç¨³å®šä¹ æƒ¯ã€‚'
    const judgement = getJudgement(score)
    const coreLine = getCoreLine(module, score)
    const sw = getStrengthWeakness(module, score)
    return {
      module,
      raw,
      max,
      score,
      level,
      judgement,
      coreLine,
      suggestion,
      strength: sw.strength,
      weakness: sw.weakness
    }
  })
})

const overallScore = computed(() => {
  const arr = results.value.map(r => r.score)
  if (!arr.length) return 0
  const avg = Math.round(arr.reduce((a, b) => a + b, 0) / arr.length)
  return avg
})

// ========== å®¶åº­äººæ‰ç”»åƒæ ‡ç­¾ç³»ç»Ÿï¼ˆæŒ‰ä½ ç»™çš„è§„åˆ™ï¼‰ ==========
function getScoreByDim(dim) {
  const item = results.value.find(x => x.module === dim)
  return item ? item.score : 0
}

function generatePortrait() {
  const self = getScoreByDim('æˆä¸ºè‡ªå·±')
  const live = getScoreByDim('è°‹ç”Ÿæ‰‹æ®µ')
  const learn = getScoreByDim('æˆæ‰')
  const happy = getScoreByDim('å¹¸ç¦åŠ›')
  const family = getScoreByDim('å®¶åº­è´£ä»»')
  const adult = getScoreByDim('æˆäºº')

  // å·¥å…·å‡½æ•°
  const allDims = [self, live, learn, happy, family, adult]
  const allGe70 = allDims.every(s => s >= 70)
  const allLt70 = allDims.every(s => s < 70)

  // å…ˆåˆ¤é«˜é£é™©/ä¼˜å…ˆçº§æœ€é«˜
  if (learn >= 70 && happy < 60) {
    return portraitPack('ğŸ“š é«˜èƒ½ç„¦è™‘å‹',
      'å­¦ä¹ èƒ½åŠ›å¼ºï¼Œä½†å¿ƒç†å‹åŠ›å’Œæƒ…ç»ªæ”¯æŒä¸è¶³ï¼Œå®¹æ˜“å‡ºç°å†…è€—æˆ–çªç„¶å´©æºƒã€‚',
      ['å­¦ä¹ å¼•å¯¼æœ‰æ•ˆï¼Œèƒ½æ¨åŠ¨å­©å­è¿›æ­¥', 'ä½†æƒ…ç»ªæ‰¿è½½ä¸è¶³ï¼Œå‹åŠ›æ—¶å®¹æ˜“å¤±æ§'],
      ['å¯èƒ½å‡ºç°åŒå­¦/èº¯ä½“åŒ–/æƒ…ç»ªçˆ†å‘', 'é•¿æœŸå†…è€—å¯¼è‡´åŠ¨åŠ›ä¸‹é™'],
      ['ç«‹å³å‡è´Ÿï¼šå…ˆç¨³å®šæƒ…ç»ªï¼Œå†è°ˆæˆç»©', 'å»ºç«‹æƒ…ç»ªè¡¨è¾¾ä¸å¤ç›˜æœºåˆ¶', 'æŠŠâ€œåŠªåŠ›â€è½¬æˆâ€œå¯æ§æ–¹æ³•â€'],
      planFor('é«˜èƒ½ç„¦è™‘å‹')
    )
  }

  if (live >= 70 && adult < 60) {
    return portraitPack('âš ï¸ åŠŸåˆ©å†’é™©å‹',
      'ç”Ÿå­˜æŠ€èƒ½å’Œç»“æœå¯¼å‘å¾ˆå¼ºï¼Œä½†å“æ ¼åº•çº¿ä¸è§„åˆ™ä¸€è‡´æ€§ä¸è¶³ï¼Œå®¹æ˜“å‡ºç°ä»·å€¼è§‚åå·®ã€‚',
      ['èƒ½æ¨åŠ¨å­©å­â€œåšäº‹ã€èµšé’±ã€åˆ›é€ ä»·å€¼â€', 'æ‰§è¡ŒåŠ›å¼ºã€æ•¢è¯•é”™'],
      ['å¯èƒ½å¿½è§†åº•çº¿ä¸è§„åˆ™ï¼Œå‡ºç°è¯šä¿¡/äººé™…é£é™©', 'çŸ­æœŸåŠŸåˆ©å¯¼è‡´é•¿æœŸä¿¡ç”¨å—æŸ'],
      ['åˆ»ä¸å®¹ç¼“ï¼šè¡¥â€œå“æ ¼åº•çº¿â€ä¸è§„åˆ™ä¸€è‡´æ€§', 'æŠŠæˆåŠŸå®šä¹‰ä¸ºâ€œé•¿æœŸä¿¡ç”¨èµ„äº§â€', 'å»ºç«‹æ‰¿è¯ºä¸åæœæœºåˆ¶'],
      planFor('åŠŸåˆ©å†’é™©å‹')
    )
  }

  if (family >= 70 && self < 60) {
    return portraitPack('ğŸ¡ æ¸©å®¤çœ‹æŠ¤å‹',
      'å…³çˆ±å……è¶³ã€ç…§é¡¾åˆ°ä½ï¼Œä½†æ”¾æ‰‹ä¸è¶³ï¼Œå­©å­è‡ªä¸»å†³ç­–ä¸æŠ—æŒ«èƒ½åŠ›åå¼±ã€‚',
      ['å®¶åº­æ”¯æŒå¼ºï¼Œå­©å­æœ‰å®‰å…¨æ„Ÿ', 'çˆ¶æ¯æ„¿æ„æŠ•å…¥ä¸æ‰¿æ‹…'],
      ['ç¦»å®¶åé€‚åº”å›°éš¾', 'é‡åˆ°æŒ«æŠ˜æ›´å®¹æ˜“å´©æºƒæˆ–ä¾èµ–'],
      ['é€æ­¥æ”¾æ‰‹ï¼šæŠŠâ€œæ”¯æŒâ€æ¢æˆâ€œæ”¯æŒå­©å­è‡ªå·±åšâ€', 'æ¯å‘¨ç»™ä¸€æ¬¡è‡ªä¸»å†³ç­–æœºä¼š', 'å…è®¸å°å¤±è´¥å¹¶å¤ç›˜'],
      planFor('æ¸©å®¤çœ‹æŠ¤å‹')
    )
  }

  // ä¼˜ç§€ç»„åˆ
  if (self >= 70 && live >= 70) {
    if (happy >= 70) {
      return portraitPack('ğŸŒŸ æœªæ¥ç²¾è‹±å‹',
        'å…·å¤‡AIæ—¶ä»£çš„æ ¸å¿ƒç«äº‰åŠ›ç»„åˆï¼šç‹¬ç«‹æ€è€ƒ + è°‹ç”Ÿèƒ½åŠ› + æƒ…ç»ªéŸ§æ€§ã€‚',
        ['æœ‰æ–¹å‘æ„Ÿï¼Œèƒ½åˆ›é€ ä»·å€¼', 'èƒ½æŠ—å‹ã€èƒ½å¤ç›˜ã€èƒ½æŒç»­è¡ŒåŠ¨'],
        ['æ³¨æ„é¿å…è¿‡åº¦ç„¦è™‘æˆ–è¿‡åº¦è‡ªæˆ‘æ–½å‹'],
        ['æä¾›æ›´é«˜é˜¶æŒ‘æˆ˜ï¼šé•¿æœŸé¡¹ç›®ã€çœŸå®åé¦ˆã€å›¢é˜Ÿåä½œ', 'å¯¹æ¥èµ„æºä¸å¯¼å¸ˆ', 'å»ºç«‹ä½œå“é›†ä¸ä¿¡ç”¨èµ„äº§'],
        planFor('æœªæ¥ç²¾è‹±å‹')
      )
    }
    return portraitPack('ğŸš€ å¤©ç”Ÿåˆ›ä¸šè€…å‹',
      'ç‹¬ç«‹æ€§ä¸ä»·å€¼åˆ›é€ æ„è¯†å¼ºï¼Œæœ‰æœºä¼šèµ°å‡ºå¼ºç«äº‰åŠ›è·¯å¾„ã€‚',
      ['æ•¢é€‰æ‹©ã€æ•¢è¯•é”™ã€æ•¢åˆ›é€ ', 'å…·å¤‡å˜ç°ä¸é¡¹ç›®æ„è¯†'],
      ['å¯èƒ½è¿‡äºç†æƒ³åŒ–ï¼Œéœ€è¦ç°å®æ£€éªŒ', 'åŸºç¡€èƒ½åŠ›è¦è¡¥é½ä»¥æ”¯æ’‘é•¿æœŸ'],
      ['æä¾›çœŸå®é¡¹ç›®æœºä¼šä¸å¸‚åœºåé¦ˆ', 'è¡¥å¼ºç³»ç»Ÿå­¦ä¹ ä¸å¤ç›˜èƒ½åŠ›', 'å¼•å…¥åŒé¢‘ä¼™ä¼´ä¸å¯¼å¸ˆ'],
      planFor('å¤©ç”Ÿåˆ›ä¸šè€…å‹')
    )
  }

  if (adult >= 70 && live < 60) {
    return portraitPack('ğŸ“ ä¼ ç»Ÿä¼˜ç­‰ç”Ÿå‹',
      'å“æ ¼ä¸å­¦ä¹ åŸºç¡€å¥½ï¼Œä½†â€œå˜ç°/å‡ºè·¯/ä»·å€¼åˆ›é€ â€è®­ç»ƒä¸è¶³ï¼Œå­˜åœ¨é«˜å­¦å†ä½å°±ä¸šé£é™©ã€‚',
      ['è§„åˆ™æ„Ÿä¸å“æ ¼åŸºç¡€è¾ƒå¥½', 'å­¦ä¹ æ¨è¿›ç›¸å¯¹ç¨³å®š'],
      ['å¯èƒ½ç¼ºä¹çœŸå®ä¸–ç•Œç«äº‰åŠ›', 'å®¹æ˜“åœ¨èŒä¸šé€‰æ‹©ä¸Šè¿·èŒ«'],
      ['ç«‹å³å¯åŠ¨â€œå­¦ä»¥è‡´ç”¨â€è®­ç»ƒ', 'å»ºç«‹ä½œå“é›†/é¡¹ç›®åˆ¶å­¦ä¹ ', 'å¢åŠ ç¤¾ä¼šä½“éªŒä¸ä»·å€¼äº¤æ¢è®­ç»ƒ'],
      planFor('ä¼ ç»Ÿä¼˜ç­‰ç”Ÿå‹')
    )
  }

  if (happy >= 70 && live < 60) {
    return portraitPack('ğŸŒˆ å¿«ä¹ä½›ç³»å‹',
      'å¿ƒæ€æ›´æ¾å¼›ã€å®¶åº­æ°›å›´è¾ƒå¥½ï¼Œä½†ç›®æ ‡æ„Ÿä¸è¡ŒåŠ¨é©±åŠ¨åŠ›ä¸è¶³ï¼Œå®¹æ˜“é”™å¤±å‘å±•çª—å£ã€‚',
      ['æƒ…ç»ªç¨³å®šã€å®¶åº­æ°›å›´æ›´è½»æ¾'],
      ['ç¼ºå°‘é•¿æœŸç›®æ ‡ä¸è°‹ç”Ÿè·¯å¾„ï¼Œå¯èƒ½â€œèˆ’æœä½†æ²¡æ–¹å‘â€'],
      ['å¼•å…¥é•¿æœŸç›®æ ‡ä¸è´£ä»»æ„Ÿ', 'æ¯æœˆä¸€ä¸ªå¯äº¤ä»˜é¡¹ç›®', 'å»ºç«‹åŸºæœ¬çš„ä»·å€¼åˆ›é€ ä¸æŠ€èƒ½è®­ç»ƒ'],
      planFor('å¿«ä¹ä½›ç³»å‹')
    )
  }

  if (learn >= 70 && self < 60) {
    return portraitPack('ğŸ“– åº”è¯•æœºå™¨å‹',
      'å­¦ä¹ èƒ½åŠ›å¼ºï¼Œä½†è‡ªæˆ‘æ¢ç´¢ä¸ç‹¬ç«‹åˆ¤æ–­ä¸è¶³ï¼Œé•¿æœŸå¯èƒ½è¿·å¤±æ–¹å‘ã€‚',
      ['æˆç»©/å­¦ä¹ æ¨è¿›å¼º', 'æ‰§è¡ŒåŠ›è¾ƒå¥½'],
      ['å®¹æ˜“æŠ‘éƒã€è¿·èŒ«æˆ–è¢«å¤–ç•Œè¯„ä»·ç»‘æ¶'],
      ['æ¢ç´¢çœŸå®å…´è¶£ä¸ä»·å€¼è§‚', 'è®­ç»ƒè¡¨è¾¾ä¸é€‰æ‹©æƒ', 'å»ºç«‹ä½œå“ä¸çœŸå®åé¦ˆ'],
      planFor('åº”è¯•æœºå™¨å‹')
    )
  }

  if (family < 60 && allLt70) {
    return portraitPack('ğŸ†˜ æ”¯æŒç¼ºå¤±å‹',
      'æƒ…æ„Ÿè¿æ¥ä¸å®¶åº­å¯¼èˆªä¸è¶³ï¼Œå­©å­å®¹æ˜“èµ°å¼¯è·¯æˆ–å‡ºç°å¯¹æŠ—ã€‚',
      ['ç›®å‰æœ€é‡è¦çš„æ˜¯â€œä¿®å¤è¿æ¥â€'],
      ['å›é€†/å†·æ¼ /å¤±æ§é£é™©æ›´é«˜', 'å…³é”®èŠ‚ç‚¹å®¹æ˜“ç¼ºä¹æ–¹å‘'],
      ['é‡å»ºäº²å­å…³ç³»ï¼šä»é™ªä¼´å¼€å§‹', 'å‡å°‘å‘½ä»¤ã€å¢åŠ å…±æƒ…', 'å»ºç«‹æ¯å‘¨å®¶åº­ä¼šè®®'],
      planFor('æ”¯æŒç¼ºå¤±å‹')
    )
  }

  if (allGe70) {
    return portraitPack('ğŸ’ å…¨æ–¹ä½é¢†èˆªå‹',
      'å…­å¤§ç»´åº¦å‡è¡¡å‘å±•ï¼Œä½ å·²å…·å¤‡ç¨³å®šçš„å®¶åº­æ•™è‚²ç³»ç»Ÿã€‚',
      ['ç³»ç»Ÿå®Œæ•´ã€ç¨³å®šè¾“å‡º', 'å­©å­æ›´å®¹æ˜“èµ°åœ¨æ­£ç¡®è·¯å¾„ä¸Š'],
      ['éœ€è¦æŒç»­å­¦ä¹ ä¿æŒé¢†å…ˆï¼Œé¿å…å›ºåŒ–'],
      ['åŠ å…¥é¢†èˆªè€…ç¤¾ç¾¤äº’ç›¸æ”¯æŒ', 'æŠŠä¼˜åŠ¿å˜æˆå¯å¤åˆ¶çš„æ–¹æ³•', 'å¸¦å­©å­åšæ›´é«˜é˜¶å®è·µ'],
      planFor('å…¨æ–¹ä½é¢†èˆªå‹')
    )
  }

  // é»˜è®¤
  return portraitPack('ğŸ“ˆ å‘å±•ä¸­å‹',
    'æ•´ä½“å¤„äºâ€œåœ¨è·¯ä¸Šâ€çš„çŠ¶æ€ï¼šä½ å·²ç»åšå¯¹äº†ä¸€éƒ¨åˆ†ï¼Œä½†ä»æœ‰å…³é”®çŸ­æ¿éœ€è¦ä¼˜å…ˆè¡¥å¼ºã€‚',
    ['æœ‰ä¸€å®šæ”¯æŒä¸æŠ•å…¥', 'æ„¿æ„å­¦ä¹ ä¸è°ƒæ•´'],
    ['çŸ­æ¿ç»´åº¦å¯èƒ½å†³å®šæœªæ¥ä¸Šé™'],
    ['ä¼˜å…ˆè¡¥æœ€çŸ­æ¿çš„ç»´åº¦ï¼ˆä½åˆ†é¡¹ï¼‰', 'ç”¨â€œæ¯å‘¨ä»»åŠ¡+å¤ç›˜â€åšæˆç¨³å®šä¹ æƒ¯', 'ç”¨ä½œå“/å®è·µè®©å­©å­èƒ½åŠ›å¯è§åŒ–'],
    planFor('å‘å±•ä¸­å‹')
  )
}

function portraitPack(name, desc, traits, risks, actions, plan) {
  return { name, desc, traits, risks, actions, plan }
}

function planFor(type) {
  // ç»™æ¯ä¸ªç”»åƒä¸€ä¸ªâ€œå¤ŸçŸ­ã€èƒ½æ‰§è¡Œâ€çš„è®¡åˆ’
  const base = {
    week: ['æ¯å¤©15åˆ†é’Ÿæ— æ‰‹æœºé™ªä¼´', 'æœ¬å‘¨åšä¸€æ¬¡å®¶åº­ä¼šè®®ï¼šè®©å­©å­è¯´ã€ä½ åªæé—®', 'æŒ‘ä¸€ä¸ªä½åˆ†ç»´åº¦ï¼Œç«‹åˆ»åšä¸€ä¸ªå°è¡ŒåŠ¨'],
    month: ['å®Œæˆ1ä¸ªå¯äº¤ä»˜å°é¡¹ç›®ï¼ˆä½œå“/å±•ç¤º/å®è·µï¼‰', 'å»ºç«‹ä¸€æ¬¡â€œå¤ç›˜å¯¹è¯â€æ¨¡æ¿ï¼ˆå‘ç”Ÿäº†ä»€ä¹ˆâ†’æ„Ÿå—â†’éœ€è¦â†’ä¸‹ä¸€æ­¥ï¼‰', 'å‡å°‘å‘½ä»¤ï¼Œå¢åŠ åå•†ä¸è¾¹ç•Œä¸€è‡´æ€§'],
    qtr: ['æœ€ä½åˆ†ç»´åº¦æå‡åˆ°60+', 'å­©å­å½¢æˆè‡³å°‘1ä¸ªç¨³å®šèƒ½åŠ›/ä½œå“', 'å®¶åº­è§„åˆ™æ›´ç¨³å®šã€å†²çªæ›´å°‘ã€æ²Ÿé€šæ›´é¡º']
  }

  const map = {
    æ¸©å®¤çœ‹æŠ¤å‹: {
      week: ['æœ¬å‘¨ç»™å­©å­1æ¬¡â€œå®Œå…¨è‡ªä¸»å†³ç­–â€çš„å°äº‹é¡¹', 'é‡åˆ°é—®é¢˜å…ˆé—®ï¼šä½ æ‰“ç®—æ€ä¹ˆåšï¼Ÿ', 'å…è®¸ä¸€æ¬¡å°å¤±è´¥å¹¶å¤ç›˜'],
      month: ['æ¯å‘¨è‡³å°‘1æ¬¡æ”¾æ‰‹è®­ç»ƒï¼ˆå­©å­è´Ÿè´£ã€ä½ åªæ”¯æŒï¼‰', 'å»ºç«‹å®¶åº­ä¼šè®®æœºåˆ¶', 'æŠŠâ€œåŒ…åŠâ€æ”¹ä¸ºâ€œæä¾›é€‰é¡¹â€'],
      qtr: ['æˆä¸ºè‡ªå·±æå‡åˆ°65+', 'å­©å­èƒ½ç‹¬ç«‹å¤„ç†1-2ç±»ç”Ÿæ´»é—®é¢˜', 'å®¶é•¿å‡å°‘ç„¦è™‘ä¸æ§åˆ¶å†²åŠ¨']
    },
    ä¼ ç»Ÿä¼˜ç­‰ç”Ÿå‹: {
      week: ['å’Œå­©å­èŠä¸€æ¬¡â€œé’±ä¸ä»·å€¼äº¤æ¢â€', 'å¼•å¯¼å­©å­åšä¸€ä¸ªå¯å±•ç¤ºçš„å°æˆæœ', 'æ•™ä¼šå­©å­ç”¨ä¸€ä¸ªAIå·¥å…·å®Œæˆä»»åŠ¡'],
      month: ['å»ºç«‹æ•°å­—ä½œå“é›†ï¼ˆå“ªæ€•ä¸€ä¸ªæ–‡ä»¶å¤¹+æ¯å‘¨æ›´æ–°ï¼‰', 'å®‰æ’ä¸€æ¬¡çœŸå®ç¤¾ä¼šä½“éªŒ/é¡¹ç›®', 'æ¯æœˆä¸€ä¸ªâ€œåˆ›é€ ä»·å€¼â€å°é¡¹ç›®'],
      qtr: ['è°‹ç”Ÿæ‰‹æ®µæå‡åˆ°60+', 'è‡³å°‘3ä¸ªä½œå“/é¡¹ç›®', 'å­©å­èƒ½è¯´æ¸…æ¥šâ€œæˆ‘èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜â€']
    },
    é«˜èƒ½ç„¦è™‘å‹: {
      week: ['å…ˆå‡è´Ÿï¼šç æ‰ä¸€é¡¹ä½æ”¶ç›Šä»»åŠ¡', 'æ¯å¤©ä¸€æ¬¡æƒ…ç»ªè¯†åˆ«å¯¹è¯', 'æŠŠç›®æ ‡æ‹†å°åˆ°å¯æ§è¡ŒåŠ¨'],
      month: ['å»ºç«‹æƒ…ç»ªå¤ç›˜ä¹ æƒ¯ï¼ˆæ¯å‘¨1æ¬¡ï¼‰', 'è¿åŠ¨/ç¡çœ ä¼˜å…ˆçº§ä¸Šè°ƒ', 'å­¦ä¹ ä»â€œæ‹¼å‘½â€æ”¹ä¸ºâ€œæ–¹æ³•è®ºâ€'],
      qtr: ['å¹¸ç¦åŠ›æå‡åˆ°60+', 'å­©å­å‹åŠ›æ—¶èƒ½è‡ªæˆ‘è°ƒèŠ‚', 'å­¦ä¹ æ•ˆç‡æå‡ä½†æƒ…ç»ªæ›´ç¨³']
    },
    å¤©ç”Ÿåˆ›ä¸šè€…å‹: {
      week: ['æœ¬å‘¨åšä¸€æ¬¡â€œçœŸå®åé¦ˆâ€æµ‹è¯•ï¼ˆå–/å±•ç¤º/ç”¨æˆ·è¯„ä»·ï¼‰', 'å¤ç›˜ï¼šä¸ºä»€ä¹ˆåˆ«äººæ„¿æ„ä»˜è´¹/ç‚¹èµ', 'è¡¥ä¸€ä¸ªåŸºç¡€çŸ­æ¿ï¼ˆå­¦ä¹ /è§„åˆ™/åˆä½œï¼‰'],
      month: ['å®Œæˆ1ä¸ªæŒç»­æ€§å°é¡¹ç›®ï¼ˆå¯è¿­ä»£ï¼‰', 'å»ºç«‹ä½œå“é›†ä¸æ•°æ®è®°å½•', 'å¯¹æ¥1ä½å¯¼å¸ˆæˆ–åŒé¢‘ä¼™ä¼´'],
      qtr: ['å½¢æˆå¯æŒç»­é¡¹ç›®é—­ç¯', 'å­©å­èƒ½è®²æ¸…å•†ä¸šé€»è¾‘æˆ–ä»·å€¼é€»è¾‘', 'åŒæ—¶ä¿æŒå­¦ä¹ åŸºç¡€ä¸æ‰é˜Ÿ']
    },
    åŠŸåˆ©å†’é™©å‹: {
      week: ['å»ºç«‹â€œæ‰¿è¯ºâ€”åæœâ€æœºåˆ¶ï¼ˆè¯´åˆ°åšåˆ°ï¼‰', 'å®¶åº­è§„åˆ™ä¸€è‡´æ€§è®­ç»ƒ', 'è®¨è®ºä¸€æ¬¡â€œåº•çº¿ä¸ä¿¡ç”¨â€'],
      month: ['å¼•å…¥é•¿æœŸé¡¹ç›®ï¼šè¿‡ç¨‹æ¯”ç»“æœé‡è¦', 'è®©å­©å­ä½“éªŒè¯šä¿¡å¸¦æ¥çš„ä¿¡ä»»æ”¶ç›Š', 'å‡å°‘çŸ­æœŸåŠŸåˆ©åˆºæ¿€'],
      qtr: ['æˆäººç»´åº¦æå‡åˆ°60+', 'å­©å­æ›´å®ˆè§„åˆ™ã€æ›´èƒ½åˆä½œ', 'ä¿¡ç”¨æ„Ÿä¸è¾¹ç•Œæ„Ÿæ›´æ¸…æ™°']
    },
    å¿«ä¹ä½›ç³»å‹: {
      week: ['è®¾ä¸€ä¸ªå°ç›®æ ‡ï¼šæœ¬å‘¨äº¤ä»˜ä¸€ä¸ªæˆæœ', 'æ¯å¤©10åˆ†é’Ÿä¸“æ³¨ç»ƒä¹ ï¼ˆæŠ€èƒ½/è¡¨è¾¾ï¼‰', 'å»ºç«‹â€œè´£ä»»äº‹é¡¹â€'],
      month: ['æ¯æœˆä¸€ä¸ªé¡¹ç›®åˆ¶ä»»åŠ¡', 'è®©å­©å­å‚ä¸ä¸€æ¬¡ä»·å€¼äº¤æ¢ä½“éªŒ', 'æŠŠå…´è¶£å˜æˆå¯è§ä½œå“'],
      qtr: ['è°‹ç”Ÿæ‰‹æ®µæå‡åˆ°60+', 'å­©å­æœ‰æ–¹å‘æ„Ÿä¸è¡ŒåŠ¨åŠ›', 'ä¿æŒå¹¸ç¦åŠ›ä¼˜åŠ¿ä¸ä¸¢']
    },
    åº”è¯•æœºå™¨å‹: {
      week: ['åœæ­¢æ¯”è¾ƒä¸€æ¬¡ã€å¢åŠ å€¾å¬ä¸€æ¬¡', 'è®©å­©å­é€‰ä¸€ä¸ªå…´è¶£æ–¹å‘ï¼ˆ3ä¸ªæœˆï¼‰', 'åšä¸€æ¬¡å¹³ç­‰è®¨è®º'],
      month: ['å»ºç«‹è¡¨è¾¾è®­ç»ƒï¼šæ¯å‘¨ä¸€æ¬¡æ¼”è®²/åˆ†äº«', 'åšä½œå“ï¼šæŠŠå­¦ä¹ å˜æˆäº§å‡º', 'å¢åŠ é€‰æ‹©æƒä¸è‡ªä¸»å†³ç­–'],
      qtr: ['æˆä¸ºè‡ªå·±æå‡åˆ°60+', 'å­©å­èƒ½è¯´æ¸…å–œæ¬¢/ä¸å–œæ¬¢', 'å­¦ä¹ ä¸å†åªæ˜¯â€œåˆ·é¢˜â€']
    },
    æ”¯æŒç¼ºå¤±å‹: {
      week: ['æ¯å¤©15åˆ†é’Ÿé™ªä¼´ï¼ˆä¸è®²é“ç†ï¼‰', 'å‡å°‘å‘½ä»¤ï¼Œå…ˆå…±æƒ…', 'æœ¬å‘¨ä¸€æ¬¡å®¶åº­ä¼šè®®ï¼šåªå¬ä¸è¯„åˆ¤'],
      month: ['æ¯å‘¨å›ºå®šä¸€æ¬¡äº²å­æ´»åŠ¨', 'å»ºç«‹ç¨³å®šè§„åˆ™ä¸è¾¹ç•Œ', 'ä¿®å¤ä¿¡ä»»ï¼šæ‰¿è¯ºå¿…å…‘ç°'],
      qtr: ['å®¶åº­è´£ä»»æå‡åˆ°60+', 'å­©å­æ›´æ„¿æ„æ²Ÿé€š', 'å†²çªé¢‘ç‡ä¸‹é™æ˜æ˜¾']
    },
    å…¨æ–¹ä½é¢†èˆªå‹: {
      week: ['ä¿æŒä¼˜åŠ¿ï¼šæœ¬å‘¨å¤ç›˜ä¸€æ¬¡å®¶åº­ç³»ç»Ÿ', 'ç»™å­©å­æ›´é«˜æŒ‘æˆ˜', 'å¯¹æ¥èµ„æº/å¯¼å¸ˆ'],
      month: ['é•¿æœŸé¡¹ç›®æ¨è¿›', 'ç¤¾ç¾¤åä½œä¸åŒé¢‘ä¼™ä¼´', 'ä½œå“é›†ä½“ç³»å‡çº§'],
      qtr: ['ä¼˜åŠ¿ç»´åº¦ä¿æŒ70+', 'å­©å­å½¢æˆé•¿æœŸè‡ªé©±ç³»ç»Ÿ', 'å®¶åº­æˆé•¿ç³»ç»Ÿå¯å¤åˆ¶']
    },
    æœªæ¥ç²¾è‹±å‹: {
      week: ['æœ¬å‘¨åšä¸€æ¬¡é«˜éš¾ä»»åŠ¡æŒ‘æˆ˜', 'å¤ç›˜ï¼šå‹åŠ›ä¸‹å¦‚ä½•ç¨³å®š', 'è¡¥ä¸€ä¸ªçŸ­æ¿ç»´åº¦'],
      month: ['æ¨è¿›é•¿æœŸé¡¹ç›®ä¸å›¢é˜Ÿåä½œ', 'èµ„æºå¯¹æ¥ï¼šå¯¼å¸ˆ/ç«èµ›/å®è·µ', 'ä½œå“é›†å‡çº§ä¸ºâ€œå¯å±•ç¤ºæˆæœâ€'],
      qtr: ['ä¿æŒâ‰¥70å¹¶æ›´å‡è¡¡', 'å½¢æˆå¯æŒç»­ä»·å€¼åˆ›é€ ç³»ç»Ÿ', 'é¿å…ç„¦è™‘ï¼Œä¿æŒå¹¸ç¦åŠ›ä¼˜åŠ¿']
    },
    å‘å±•ä¸­å‹: base
  }

  return map[type] || base
}

const portrait = computed(() => generatePortrait())

// é›·è¾¾å›¾æ•°æ®
function renderRadar() {
  if (!radarRef.value) return
  const data = results.value
  const indicators = data.map(r => ({ name: r.module, max: 100 }))
  const values = data.map(r => r.score)

  if (!chart) chart = echarts.init(radarRef.value)

  chart.setOption({
    tooltip: {},
    radar: {
      indicator: indicators,
      radius: '65%',
      splitNumber: 5
    },
    series: [
      {
        type: 'radar',
        data: [{ value: values, name: 'ç»¼åˆæµ‹è¯„' }]
      }
    ]
  })
  chart.resize()
}

const resizeHandler = () => {
  if (chart) chart.resize()
}

onMounted(() => {
  renderRadar()
  window.addEventListener('resize', resizeHandler)
})

watch(
  () => route.query.scores,
  () => {
    renderRadar()
  }
)

onBeforeUnmount(() => {
  window.removeEventListener('resize', resizeHandler)
  if (chart) {
    chart.dispose()
    chart = null
  }
})

function goUpgrade() {
  router.push('/upgrade-info')
}
</script>

<style scoped>
.result-page {
  max-width: 1100px;
  margin: 0 auto;
  padding: 24px;
  color: var(--color-text, #111);
}

.card {
  background: #fff;
  border: 1px solid rgba(0,0,0,0.08);
  border-radius: 14px;
  padding: 18px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.06);
}

.header { margin-bottom: 16px; }

.title-row {
  display: flex;
  gap: 12px;
  align-items: flex-end;
  justify-content: space-between;
  flex-wrap: wrap;
}

h2 { margin: 0; font-size: 22px; }

.meta { display: flex; gap: 8px; flex-wrap: wrap; }

.pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(0,0,0,0.04);
  font-size: 12px;
}

.grid-two {
  margin-top: 14px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

@media (max-width: 960px) {
  .grid-two { grid-template-columns: 1fr; }
}

.inner { padding: 14px; }

.section-title {
  font-weight: 700;
  margin-bottom: 10px;
  font-size: 14px;
  opacity: 0.9;
}

.radar { width: 100%; height: 320px; }

.note {
  margin-top: 8px;
  font-size: 12px;
  opacity: 0.75;
}

.portrait-name {
  font-size: 18px;
  font-weight: 800;
  margin-bottom: 6px;
}

.portrait-desc {
  font-size: 13px;
  opacity: 0.85;
  margin-bottom: 10px;
  line-height: 1.4;
}

.portrait-box {
  border-radius: 12px;
  padding: 10px 12px;
  background: rgba(0,0,0,0.03);
  margin-bottom: 10px;
}

.portrait-box.warn { background: rgba(255, 153, 0, 0.12); }
.portrait-box.good { background: rgba(0, 180, 120, 0.12); }

.portrait-sub { font-weight: 700; margin-bottom: 6px; font-size: 13px; }

.portrait-box ul { margin: 0; padding-left: 18px; font-size: 13px; }
.portrait-box li { margin: 4px 0; }

.divider {
  height: 1px;
  background: rgba(0,0,0,0.08);
  margin: 12px 0;
}

.plan {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 10px;
}

@media (max-width: 960px) {
  .plan { grid-template-columns: 1fr; }
}

.plan-col {
  border-radius: 12px;
  padding: 10px 12px;
  background: rgba(0,0,0,0.03);
}

.plan-h { font-weight: 800; margin-bottom: 6px; font-size: 13px; }

.plan ul { margin: 0; padding-left: 18px; font-size: 13px; }
.plan li { margin: 4px 0; }

.btn {
  border: none;
  cursor: pointer;
  border-radius: 12px;
  padding: 12px 14px;
  font-weight: 800;
}

.upgrade {
  width: 100%;
  margin-top: 10px;
  background: #2b6cff;
  color: #fff;
}

.modules { margin-bottom: 16px; }

.module-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}

@media (max-width: 960px) {
  .module-grid { grid-template-columns: 1fr; }
}

.module-card {
  border-radius: 14px;
  border: 1px solid rgba(0,0,0,0.08);
  padding: 14px;
  background: #fff;
}

.module-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.module-name { font-weight: 900; font-size: 15px; }

.badge {
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 999px;
  font-weight: 800;
  background: rgba(0,0,0,0.04);
}

.b-start { background: rgba(255, 153, 0, 0.15); }
.b-basic { background: rgba(0, 120, 255, 0.12); }
.b-good { background: rgba(0, 180, 120, 0.12); }
.b-advanced { background: rgba(180, 0, 255, 0.12); }
.b-excellent { background: rgba(255, 0, 80, 0.12); }

.score-row {
  display: grid;
  grid-template-columns: 70px 1fr;
  gap: 10px;
  align-items: center;
}

.score-num {
  font-size: 34px;
  font-weight: 900;
  line-height: 1;
}

.score-tip .tip-1 { font-weight: 800; }
.score-tip .tip-2 { font-size: 12px; opacity: 0.75; margin-top: 4px; line-height: 1.4; }

.suggest { margin-top: 10px; }
.suggest-title { font-weight: 800; margin-bottom: 4px; font-size: 13px; }
.suggest-text { font-size: 13px; opacity: 0.9; line-height: 1.5; }

.mini { margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap; }
.mini-pill {
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(0,0,0,0.04);
}
.mini-pill.warn { background: rgba(255, 153, 0, 0.12); }

.footer-title { font-weight: 900; margin-bottom: 6px; }
.footer-text { font-size: 13px; opacity: 0.85; line-height: 1.5; }
</style>

